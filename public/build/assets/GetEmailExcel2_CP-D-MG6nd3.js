import{r,j as a,a as C}from"./app-DA6yD-bg.js";import{r as N,u as R}from"./xlsx-DG2X6oDA.js";import{I as j}from"./input-BMchtnkz.js";import{S as H,a as T,b as W,c as P,d as X,e as Y,f as z}from"./select-8KFRuk-M.js";import{c as J}from"./index-DTzn02tC.js";import{F as K}from"./index.es-C4Hz4JyV.js";import{A as Q,b as Z,c as $,d as L,e as ee,f as ae,g as te,h as se}from"./alert-dialog-DPhN9ELP.js";import{B as re}from"./button-Czat_LeM.js";import"./utils-Baa09YAL.js";import"./index-BSvPNBtZ.js";import"./index-wyKmaqcT.js";import"./index-DjDCE-CF.js";import"./index-D2R9fagv.js";import"./index-DKKbawXw.js";import"./index-DUFVU-Ky.js";import"./Combination-JEORXwyg.js";import"./index-gIoNW1Kd.js";import"./index-DgaNj54m.js";import"./createLucideIcon-TB6UWrdR.js";import"./index-JpmpzNkP.js";import"./index-DzzVjFRl.js";import"./index-0yB0lKw6.js";const ke=({setEmails:v})=>{const[s,F]=r.useState(""),[u,y]=r.useState(""),[h,S]=r.useState(""),[le,U]=r.useState([]),[c,D]=r.useState([]),[l,M]=r.useState(null),[o,d]=r.useState({fileUploadError:"",columnError:"",minRowError:"",maxRowError:"",validateEmailsError:"",storeEmailsError:""}),[E,V]=r.useState([]),[p,b]=r.useState(""),[w,A]=r.useState([]),[q,x]=r.useState(!1),_=e=>{const t=e.target.files[0],f=new FileReader;f.onload=i=>{M(new Uint8Array(i.target.result));const m=N(new Uint8Array(i.target.result),{type:"array"});V(m.SheetNames),m.SheetNames.length===1&&b(m.SheetNames[0])},f.readAsArrayBuffer(t)};r.useEffect(()=>{if(l&&s){const t=N(l,{type:"array"}).Sheets[p],m=R.sheet_to_json(t,{header:1,raw:!1}).map(n=>n[s.charCodeAt(0)-65]).filter(n=>n!==void 0);y("1"),S(m.length.toString())}},[l,s]),r.useEffect(()=>{if(l&&s&&u&&h&&p){const t=N(l,{type:"array"}).Sheets[p],f=R.sheet_to_json(t,{header:"A",raw:!1}),i={};f.forEach((n,k)=>{k+1<Number(u)||k+1>Number(h)||Object.keys(n).forEach(g=>{i[g]||(i[g]=[]),n[g]!==""&&i[g].push(n[g])})}),U(i);const m=i[s]||[];D(m),d(n=>({...n,columnError:""})),console.log(m),console.log(c)}if(s===""){d({fileUploadError:"",columnError:"",minRowError:"",maxRowError:"",validateEmailsError:""});return}!l&&s!==""&&d(e=>({...e,fileUploadError:"Please upload a file before entering a column."}))},[s,l,u,h,p]);const B=e=>{const t=[...c];t.splice(e,1),D(t),e===0?y(t.length>0?"1":""):e===c.length-1&&S(t.length>0?t.length.toString():"")},I=async()=>{try{const e=await C.post("/api/v1/validate-emails",{emails:c.map(t=>({email:t})),removeDuplicates:!1});console.log(e.data),d(t=>({...t,validateEmailsError:""})),A(e.data.emails),v(e.data.emails),e.data.message.includes("Duplicate")&&x(!0),G(),console.log("File data:",l),console.log("Sheet name:",p),console.log("Column letter:",s),console.log("Min row:",u),console.log("Max row:",h),console.log("Filtered data:",c),console.log("Response from /api/v1/validate-emails:",e.data),console.log("Unique emails:",w)}catch(e){console.error(e.response.data),e.response.data.message&&(d(t=>({...t,validateEmailsError:e.response.data.message})),e.response.data.message.includes("Duplicate")&&x(!0))}},O=async()=>{x(!1);try{const e=await C.post("/api/v1/validate-emails",{emails:c.map(t=>({email:t})),removeDuplicates:!0});console.log(e.data),d(t=>({...t,validateEmailsError:""})),A(e.data.emails),v(e.data.emails)}catch(e){console.error(e.response.data),e.response.data.message&&d(t=>({...t,validateEmailsError:e.response.data.message}))}},G=async()=>{const e=w.map(t=>t.email);v(t=>[...t,...e]),console.log(w)};return a.jsxs("div",{className:"flex flex-col gap-2",children:[a.jsx(j,{type:"file",onChange:_,className:"cursor-pointer",variant:"activity"}),E.length>1&&a.jsxs(H,{onValueChange:e=>b(e),children:[a.jsx(T,{className:"w-[180px] mt-1",children:a.jsx(W,{placeholder:"Select a Sheet",defaultValue:p})}),a.jsx(P,{children:a.jsxs(X,{label:"Sheet Names",children:[a.jsx(Y,{children:"Sheets"}),E.map((e,t)=>a.jsx(z,{value:e,children:e},t))]})})]}),E.length>0&&a.jsx(j,{type:"text",className:"my-1",placeholder:"Enter column letter",value:s,variant:"activity",onChange:e=>F(e.target.value.toUpperCase())}),s!==""&&a.jsxs("div",{className:"flex gap-1",children:[a.jsx(j,{type:"number",min:"1",placeholder:"Enter min row number",value:u,variant:"activity",onChange:e=>y(e.target.value)}),a.jsx(j,{type:"number",min:"1",placeholder:"Enter max row number",value:h,variant:"activity",onChange:e=>S(e.target.value)})]}),o.fileUploadError&&a.jsx("p",{className:"text-red-500 text-xs italic",children:o.fileUploadError}),o.columnError&&a.jsx("p",{className:"text-red-500 text-xs italic",children:o.columnError}),o.minRowError&&a.jsx("p",{className:"text-red-500 text-xs italic",children:o.minRowError}),o.maxRowError&&a.jsx("p",{className:"text-red-500 text-xs italic",children:o.maxRowError}),s!==""&&(c.length>0?a.jsxs("div",{className:"mt-4 flex flex-col",children:[a.jsx("p",{className:"mb-2 text-sm",children:"Extracted:"}),a.jsx("div",{className:"flex flex-row flex-wrap",children:c.map((e,t)=>a.jsx("div",{className:"m-1",children:a.jsxs("p",{className:"w-fit rounded-full bg-blue-300 px-4 py-2 text-black text-xs",children:[e,a.jsx("span",{className:"ml-2 cursor-pointer",onClick:()=>B(t),children:a.jsx(K,{icon:J})})]})},t))})]}):!o.columnError&&a.jsx("div",{className:"mt-4 flex flex-col",children:a.jsx("p",{className:"text-lg text-gray-800",children:"No data found"})})),E.length>0&&a.jsx("div",{className:"mt-4 flex justify-end",children:a.jsx("div",{className:"flex-col",children:a.jsx(re,{type:"button",onClick:I,disabled:!s||!l||!p,children:"Validate Emails"})})}),a.jsx(Q,{open:q,onOpenChange:x,children:a.jsxs(Z,{children:[a.jsxs($,{children:[a.jsx(L,{children:"Delete Duplicate Emails "}),a.jsxs(ee,{children:[a.jsx("p",{className:"mb-2",children:"We have detected duplicate emails in your list. Would you like us to remove them for you?"}),a.jsx("p",{children:"Having duplicate emails can result in sending invites and notifications multiple times to the same email address, corresponding to the number of times it appears in the list."})]})]}),a.jsxs(ae,{children:[a.jsx(te,{variant:"outline",onClick:()=>x(!1),children:"No"}),a.jsx(se,{variant:"",onClick:O,children:"Yes"})]})]})})]})};export{ke as default};
