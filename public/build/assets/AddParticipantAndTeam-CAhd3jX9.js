import{r as t,j as e,a as n}from"./app-DA6yD-bg.js";import{u as H}from"./use-toast-DSZ2X8Ft.js";import{I as u}from"./input-BMchtnkz.js";import{L as f}from"./label-DJGv7VYA.js";import{B as j}from"./button-Czat_LeM.js";import{T as C,a as I,b as P,c as F,C as K}from"./checkbox-DteTE1QY.js";import{d as k}from"./index-DTzn02tC.js";import{F as q}from"./index.es-C4Hz4JyV.js";import Q from"./GetEmailExcel2_CP-D-MG6nd3.js";import{S as U,a as W,b as X,c as Y,d as Z,f as ee}from"./select-8KFRuk-M.js";import"./utils-Baa09YAL.js";import"./index-BSvPNBtZ.js";import"./index-wyKmaqcT.js";import"./index-DjDCE-CF.js";import"./index-DUFVU-Ky.js";import"./index-gIoNW1Kd.js";import"./index-DgaNj54m.js";import"./createLucideIcon-TB6UWrdR.js";import"./index-DKKbawXw.js";import"./index-DzzVjFRl.js";import"./index-0yB0lKw6.js";import"./xlsx-DG2X6oDA.js";import"./alert-dialog-DPhN9ELP.js";import"./Combination-JEORXwyg.js";import"./index-JpmpzNkP.js";import"./index-D2R9fagv.js";const Te=({auth:O,onClose:R,fetchTeamsAndParticipants:$,departmentsProps:G})=>{const[v,N]=t.useState(null),[ae,g]=t.useState(""),{toast:c}=H(),[m,d]=t.useState(""),[o,E]=t.useState([]),[B,_]=t.useState(!1),[l,w]=t.useState(null),[y,b]=t.useState(""),[S,J]=t.useState(G),L=()=>{m&&(E([...o,{email:m}]),d(""))},V=async()=>{try{const s=(await n.post(`/api/v1/${O.user.id}/adddepartment`,{name:y})).data;J([...S,s]),w(s.id),b("")}catch(a){console.error("Error adding department:",a)}},M=async a=>{var A,T;a.preventDefault();const s=new FormData(document.getElementById("teamForm")),p=Object.fromEntries(s.entries());p.department_id=l;const D={emails:o.map(r=>r.email)};console.log("Participant data:",D);try{const r=await n.post("/api/v1/addteam",p);console.log("Team addition response:",r),c({variant:"success",title:"Success!",description:`${p.name} has been added to the teams.`}),g(""),N(null);const x=r.data.teamId,z=await n.post(`/api/v1/teams/${x}/addmultipleparticipants`,D);console.log("Participant addition response:",z),c({variant:"success",title:"Success!",description:"Participants have been added to the team."}),d(""),$();try{const i=await n.post(`/api/v1/teams/${x}/add-department`,{department_id:l});console.log(i.data)}catch(i){console.error("Error adding department to team:",i)}for(const i of o)try{const h=await n.post("/api/v1/invite",{email:i.email,team_id:x});console.log(h.data)}catch(h){console.error("Error inviting participant:",h)}}catch(r){console.error("Error:",r),c({variant:"destructive",title:"Error!",description:`An error occurred. ${((T=(A=r.response)==null?void 0:A.data)==null?void 0:T.message)||r.message}`})}finally{R()}};return t.useEffect(()=>{console.log("selectedDepartmentId",l)},[l]),e.jsx("div",{className:"p-4 min-h-full ",children:e.jsxs("form",{id:"teamForm",onSubmit:M,children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Adicione Equipa e Participantes"}),e.jsxs("div",{className:"gap-4 flex flex-col",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"flex flex-row",children:[e.jsx(f,{htmlFor:"name",className:"block text-sm leading-8 font-medium text-gray-700",children:"Nome da Equipa"}),e.jsx(C,{onOpenAutoFocus:a=>a.preventDefault(),children:e.jsxs(I,{children:[e.jsx(P,{className:"cursor-pointer",children:e.jsx(q,{className:"ms-2",icon:k})}),e.jsx(F,{children:e.jsxs("p",{className:"text-sm",children:["Insira o nome da equipa. Exemplo: ",e.jsx("strong",{children:"Equipa de Marketing"})]})})]})})]}),e.jsxs("div",{className:"flex flex-row",children:[e.jsx(u,{type:"text",name:"name",id:"name",variant:"activity",placeholder:"Team Name",onChange:a=>{g(a.target.value),N(null)},className:"mt-1 p-2 border border-gray-300 rounded-md"}),v&&e.jsx("p",{className:"text-red-500 text-xs italic",children:v})]})]}),e.jsx("div",{className:"flex flex-row",children:e.jsxs(U,{onValueChange:a=>{const s=JSON.parse(a);w(s.id)},children:[e.jsx(W,{className:"min-w-fit",children:e.jsx(X,{placeholder:"Selecione um Departmento"})}),e.jsx(Y,{children:e.jsxs(Z,{label:"Departments",children:[S.map(a=>e.jsx(ee,{value:JSON.stringify({id:a.id,name:a.name}),children:a.name},a.id)),e.jsxs("div",{className:"flex flex-row",children:[e.jsx(u,{type:"text",name:"newDepartment",id:"newDepartment",variant:"activity",placeholder:"New Department Name",value:y,onChange:a=>b(a.target.value)}),e.jsx(j,{variant:"secondary",className:"ms-2 mt-1",type:"button",onClick:V,children:"Adicionar Departmento"})]})]})})]})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"flex flex-row",children:[e.jsx(f,{htmlFor:"emails",className:"block text-sm leading-8 font-medium text-gray-700",children:"Emails de Participantes"}),e.jsx(C,{children:e.jsxs(I,{children:[e.jsx(P,{className:"cursor-pointer",children:e.jsx(q,{className:"ms-2",icon:k})}),e.jsx(F,{children:e.jsx("p",{className:"text-sm",children:"Adicione os emails dos participantes que deseja adicionar Ã  equipa."})})]})})]}),e.jsxs("div",{className:"flex flex-row",children:[e.jsx(u,{type:"text",name:"email",id:"email",variant:"activity",placeholder:"Email",className:"mt-1 p-2 border border-gray-300 rounded-md",value:m,onChange:a=>{d(a.target.value)}}),e.jsx(j,{variant:"secondary",className:"ms-2 mt-1",type:"button",onClick:L,children:"Adicionar Email"})]}),e.jsxs("div",{className:"flex items-center space-x-2 mt-2",children:[e.jsx(K,{id:"terms",onCheckedChange:a=>_(a)}),e.jsx(f,{htmlFor:"terms",className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:"Extrair emails de ficheiros .csv/ .xlsx."})]}),B&&e.jsx("div",{className:"mt-4",children:e.jsx(Q,{setEmails:E})}),e.jsx("div",{className:"flex flex-row flex-wrap",children:o.map((a,s)=>e.jsx("div",{className:"mt-2 mr-2",children:e.jsx("p",{className:"w-fit rounded-full bg-green-300 px-4 py-2 text-black text-xs",children:a.email})},s))})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx(j,{type:"submit",children:"Adicionar Equipa e Participantes"})})]})]})})};export{Te as default};
