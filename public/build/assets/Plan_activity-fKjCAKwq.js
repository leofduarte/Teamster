import{r as s,j as e,a as h}from"./app-DA6yD-bg.js";import{F as C}from"./index.es-C4Hz4JyV.js";import{f as je,i as be,j as ye}from"./index-DTzn02tC.js";import{c as Ne}from"./utils-Baa09YAL.js";import{Layout as Se}from"./Layout-CD6lmAmp.js";import Pe from"./Output-DqRILZ5t.js";import{P as Ae,a as Ee,b as we,S as Ce}from"./slider-DDajtrlP.js";import{f as Oe,C as Ie}from"./calendar-Bxp1gLpD.js";import{I as j}from"./input-BMchtnkz.js";import{T as Te}from"./textarea-bNjw3qJ2.js";import{d as ke}from"./index-CNbTJdn3.js";import{S as Le,a as Re,b as qe,c as De,f as Je}from"./select-8KFRuk-M.js";import{B as b}from"./button-Czat_LeM.js";import{P as Me}from"./Profile-DEOHT7JD.js";import"./index-0yB0lKw6.js";import"./logo-teamster-DKsO-BHU.js";import"./index-BSvPNBtZ.js";import"./index-wyKmaqcT.js";import"./index-DjDCE-CF.js";import"./index-DUFVU-Ky.js";import"./Combination-JEORXwyg.js";import"./index-gIoNW1Kd.js";import"./index-DgaNj54m.js";import"./createLucideIcon-TB6UWrdR.js";import"./index-DKKbawXw.js";import"./index-JpmpzNkP.js";import"./index-D2R9fagv.js";import"./chevron-right-DntUEiCU.js";import"./index-DzzVjFRl.js";function ja(n){const[O,z]=s.useState([]),[ze,F]=s.useState(null),[U,y]=s.useState("");console.log("Props:",n),console.log(n.planActivity),s.useEffect(()=>{(async()=>{try{const t=await h.get("/api/v1/activities");z(t.data),console.log("Activities Para o Sidebar",t.data)}catch(t){console.error("Error fetching activities:",t)}})()},[]);const $=async a=>{try{const t=await h.post(`/api/v1/atividade/detalhes/${a.id}`);F(t.data),console.log("Selected activity:",t.data),ke.Inertia.visit(`/atividade/detalhes/${a.id}`)}catch(t){console.error("Error fetching selected activity:",t)}},H=e.jsxs("div",{className:"w-full flex flex-col",children:[e.jsx("div",{className:"joyride-profile",children:e.jsx(Me,{id:n.auth})}),e.jsxs("div",{className:"text-center flex flex-col items-center",children:[e.jsx("h2",{className:"text-3xl font-serif mb-3",children:"+ Atividades"}),O.length>0?O.map((a,t)=>e.jsx("div",{className:"mb-2 pb-2 border-b-2 border-gray-300 hover:border-black w-[80%]",children:e.jsx("button",{onClick:()=>$(a),className:"hover:border-black",children:e.jsxs("p",{children:[a.name," ",e.jsx(C,{icon:je,className:"ml-6"})]})})},t)):e.jsx("p",{className:"text-gray-500",children:"Nenhuma atividade encontrada"})]})]}),[V,Fe]=s.useState(n.planActivity);s.useEffect(()=>{n.planActivity&&(console.log("data",n),d({nome:n.planActivity.name||"",objetivos:JSON.parse(n.planActivity.objectives)||[],objetivo:[],localizacao:n.planActivity.location||"",dia:n.planActivity.date||"",numParticipantes:n.planActivity.participants||"",orcamento:n.planActivity.price||"",observacoes:n.planActivity.observations||"",duracao:n.planActivity.duration||""}))},[n.planActivity]),console.log("Selected Plan Activity:",V);const[l,d]=s.useState({nome:"",objetivo:"",objetivos:[],localizacao:"",orcamento:[0],numParticipantes:"",dia:"",observacoes:"",duracao:""}),[S,I]=s.useState(!1),[P,_]=s.useState([]),[T,k]=s.useState([]),[B,G]=s.useState(null),[L,K]=s.useState(""),{nome:R,objetivo:f,objetivos:A,localizacao:E,orcamento:q,numParticipantes:N,dia:u,observacoes:W,duracao:D}=l,g=a=>{const{name:t,value:o}=a.target;d(r=>({...r,[t]:o}))},[Q,Ue]=s.useState([]),[$e,X]=s.useState([]),[Y,Z]=s.useState([]),[ee,ae]=s.useState([]),[te,se]=s.useState([]),J=s.useCallback(async a=>{d(t=>({...t,numParticipantes:a.participantsLength})),G(a.id),console.log("Equipa selecionada:",a.id);try{const t=await h.post("/api/v1/getParticipantsFromTeams");X(t.data),console.log("Teams and participants:",t.data);const o=t.data.find(r=>r.id===a.id);if(o&&o.participants){o.participants.forEach(i=>{if(i.hobbies){const v=JSON.parse(i.hobbies)}});const r=o.participants.map(i=>i.hobbies?JSON.parse(i.hobbies):[]).flat();se(r),console.log("Hobbies:",r);const p=o.participants.map(i=>{if(i.passions&&i.passions!=="null"&&i.passions!=="")try{return JSON.parse(i.passions)}catch(v){return console.error("Error parsing likes for participant:",i.id,v),[]}return[]}).flat();ae(p),console.log("Likes:",p);const x=o.participants.map(i=>i.restrictions?JSON.parse(i.restrictions):[]).flat();Z(x),console.log("Restrições:",x)}}catch(t){console.error("Error fetching participants and their data:",t)}},[]),oe=s.useCallback(a=>{d(t=>({...t,orcamento:[a[0]]}))},[]),M=()=>{m(f)?alert("Objetivo não pode estar vazio"):d(a=>({...a,objetivos:[...a.objetivos,f],objetivo:""}))},ie=a=>{a.key==="Enter"&&M()},re=a=>{const t=a.currentTarget.value;d(o=>({...o,objetivos:Array.isArray(o.objetivos)?o.objetivos.filter(r=>r!==t):[]}))},m=a=>typeof a=="string"?a.trim()==="":Array.isArray(a)?a.length===0:!1;s.useEffect(()=>{h.post("/api/v1/equipas").then(a=>{k(a.data.map(t=>({name:t.name,id:t.id,participants:t.participants}))),console.log("Equipas",T)})},[]);const[He,w]=s.useState([]),[ne,ce]=s.useState([]),[le,de]=s.useState([]),[me,pe]=s.useState([]),[xe,ve]=s.useState([]),he=async a=>{try{const o=(await h.get("/api/v1/getpartners")).data.data;if(Array.isArray(o)){const r=o.filter(c=>c.location===a);w(r);const p=r.map(c=>c.location),x=r.map(c=>c.name),i=r.map(c=>c.description),v=r.map(c=>c.url);ce(p),de(x),pe(i),ve(v),console.log("Parceiros filtrados",r),console.log("Localização dos Parceiros",p),console.log("Nome dos Parceiros",x),console.log("Descrição dos Parceiros",i),console.log("Url dos Parceiros",v)}else console.error("Expected an array for partners, but received:",o),w([])}catch(t){console.error("Error fetching partners:",t),w([])}},ue=async()=>{if(console.log("Clicou em Gerar atividade"),m(R)||m(E)||m(N)||m(u)||m(D)||A.length===0){alert("Preencha todos os campos");return}try{y("A sua atividade está a ser gerada..."),await he(E),console.log("Enviando o formulário...");const a=h.post("/api/v1/atividade-inicial",{...l,orcamento:[l.orcamento[0]],passions:ee,hobbies:te,restricoes:Y,partnersLocation:ne,partnersName:le,partnersDescription:me,partnersUrl:xe});y("");const t=h.post("/api/v1/save-plan-activities",{...l,orcamento:[l.orcamento[0]],team_id:B,participants:Q}),[o,r]=await Promise.all([a,t]);y("");const{nome:p,descricao:x,atividades:i,horario:v,tarefas_planeamento:c,tarefas_participante:ge}=o.data;K(r.data.data.id),console.log("ID from responseTwo:",L),_([p,x,i,JSON.stringify(v),c,ge]),I(!0),r.status===200?console.log("Formulário salvo com sucesso."):console.error("Erro ao salvar formulário.")}catch(a){console.error("Erro ao enviar formulário:",a),y("")}},fe=()=>{const a={id:null,name:`${N} participants`,participantsLength:Number(N)};k(t=>[...t,a])};return s.useEffect(()=>{console.log("modalIsOpen mudou para:",S)},[S]),s.useEffect(()=>{console.log("Resultado resposta mudou para:",P)},[P]),s.useEffect(()=>{console.log("form:",l)},[l]),e.jsxs(e.Fragment,{children:[e.jsx(Se,{sidebar:H,children:e.jsx("div",{className:"mx-auto max-w-7xl sm:px-6 lg:px-8 pt-12",children:e.jsx("div",{className:"overflow-hidden",children:e.jsxs("div",{className:"p-6 text-gray-900",children:[e.jsx("h1",{className:"text-3xl font-bold text-black",children:"Planear Atividade"}),e.jsxs("div",{className:"my-6 flex flex-col gap-4",children:[e.jsx("h2",{className:"font-serif uppercase text-2xl mb-3",children:"Nova atividade"}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"flex mb-3 gap-4",children:[e.jsxs("div",{className:"w-full",children:[e.jsx("p",{className:"text-left text-xs mb-2",children:"Nome da Atividade"}),e.jsx(j,{placeholder:"Ex. Atividade 27/08",variant:"activity",name:"nome",value:R,onChange:g})]}),e.jsxs("div",{className:"w-full",children:[e.jsx("p",{className:"text-left text-xs mb-2",children:"Duração da atividade"}),e.jsx(j,{variant:"activity",placeholder:"Ex. 6 horas",name:"duracao",value:D,onChange:g})]})]}),e.jsxs("div",{className:"flex mb-3 gap-4",children:[e.jsxs("div",{className:"w-full",children:[e.jsx("p",{className:"text-left text-xs mb-2",children:"Data"}),e.jsxs(Ae,{children:[e.jsx(Ee,{asChild:!0,children:e.jsxs(b,{variant:"activity",className:Ne("mb-2 py-2 px-1 border rounded text-large w-full h-10",!u&&"text-muted-foreground"),children:[e.jsx(C,{icon:be,className:"mr-2 h-4 w-4"}),u?Oe(new Date(u),"PPP"):e.jsx("span",{children:"Escolhe uma data"})]})}),e.jsx(we,{className:"w-auto p-0",align:"start",children:e.jsx(Ie,{mode:"single",selected:u?new Date(u):void 0,onSelect:a=>d(t=>({...t,dia:a.toISOString()})),initialFocus:!0})})]})]}),e.jsxs("div",{className:"w-full",children:[e.jsx("p",{className:"text-left text-xs mb-2",children:"Localização"}),e.jsx(j,{placeholder:"Ex. Aveiro",variant:"activity",name:"localizacao",value:E,onChange:g})]})]}),e.jsxs("div",{className:"flex mb-3 gap-4",children:[e.jsxs("div",{className:"w-full",children:[e.jsx("p",{className:"text-left text-xs mb-2",children:"Equipa"}),e.jsxs(Le,{className:"w-2/5",onValueChange:a=>J(JSON.parse(a)),onChange:a=>J(JSON.parse(a)),children:[e.jsx(Re,{children:e.jsx(qe,{placeholder:"Seleciona uma equipa"})}),e.jsxs(De,{children:[T.map(a=>e.jsx(Je,{value:JSON.stringify({id:a.id,participantsLength:a.participants?a.participants.length:0}),children:a.name},a.id)),e.jsxs("div",{className:"flex flex-row",children:[e.jsx(j,{type:"number",placeholder:"Indica o número de participantes",variant:"activity",name:"numParticipantes",value:N,onChange:a=>d({...l,numParticipantes:a.target.value})}),e.jsx(b,{variant:"activity",onClick:fe,children:"Add"})]})]})]})]}),e.jsxs("div",{className:"w-full flex flex-col",children:[e.jsxs("p",{className:"text-left text-xs mb-2",children:["Orçamento:",e.jsx("span",{className:"font-bold text-sm text-center mt-1 ml-2",children:q.toLocaleString("pt-PT",{style:"currency",currency:"EUR"})})]}),e.jsx("div",{className:"flex items-center align-middle",children:e.jsx(Ce,{value:[q],onValueChange:oe,max:5e3,step:10})})]})]}),e.jsxs("div",{className:"flex flex-col mb-3",children:[e.jsx("h2",{className:"font-serif text-2xl pb-2",children:"Objetivos"}),e.jsx("p",{className:"text-left text-xs mb-2",children:"Adicione os objetivos"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx(j,{variant:"activity",className:"w-full",placeholder:"Ex. Melhorar a comunicação",value:f,onChange:g,name:"objetivo",onKeyPress:ie}),e.jsx(b,{className:`h-10 ${m(f)?"cursor-not-allowed":""}`,variant:"activity",onClick:M,disabled:m(f),children:"Adicionar"})]}),A.length>0&&e.jsx("div",{className:"flex flex-col pt-2 justify-start",children:e.jsx("div",{className:"flex",children:A.map((a,t)=>e.jsx(b,{className:"min-w-28",variant:"activity",value:a,onMouseEnter:o=>o.currentTarget.textContent="Remover",onMouseLeave:o=>o.currentTarget.textContent=a,onClick:re,children:a},t))})})]}),e.jsxs("div",{className:"flex flex-col mb-3",children:[e.jsx("h2",{className:"font-serif text-2xl pb-2",children:"Observações"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-left text-xs mb-2",children:"Escreva aqui as observações que acha importantes"}),e.jsx(Te,{className:"bg-white border-none border rounded border-gray-400 text-large shadow-md ring-1 ring-gray-200 focus-visible:border-0 h-10 px-4 py-2",placeholder:"Ex. Deslocação não incluída",variant:"activity",value:W,onChange:g,name:"observacoes"})]})]}),e.jsxs("div",{className:"flex place-content-end justify-end flex-col",children:[e.jsxs(b,{type:"button",onClick:ue,children:[e.jsx(C,{className:"mr-2",icon:ye}),"Gerar atividade"]}),e.jsx("p",{className:"text-gray-500 text-sm",children:U})]})]})]})]})})})}),S&&e.jsx(Pe,{resultadoResposta:P,onCloseModal:()=>I(!1),planActivityId:L})]})}export{ja as default};
