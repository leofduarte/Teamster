import{r as t,j as e,a as w}from"./app-DA6yD-bg.js";import{r as S,u as R}from"./xlsx-DG2X6oDA.js";import{I as E}from"./input-BMchtnkz.js";import{S as W,a as P,b as X,c as Y,d as z,e as J,f as K}from"./select-8KFRuk-M.js";import{c as Q}from"./index-DTzn02tC.js";import{F as Z}from"./index.es-C4Hz4JyV.js";import{A as L,b as ee,c as ae,d as se,e as te,f as re,g as le,h as oe}from"./alert-dialog-DPhN9ELP.js";import{B as U}from"./button-Czat_LeM.js";import{u as ie}from"./use-toast-DSZ2X8Ft.js";import"./utils-Baa09YAL.js";import"./index-BSvPNBtZ.js";import"./index-wyKmaqcT.js";import"./index-DjDCE-CF.js";import"./index-D2R9fagv.js";import"./index-DKKbawXw.js";import"./index-DUFVU-Ky.js";import"./Combination-JEORXwyg.js";import"./index-gIoNW1Kd.js";import"./index-DgaNj54m.js";import"./createLucideIcon-TB6UWrdR.js";import"./index-JpmpzNkP.js";import"./index-DzzVjFRl.js";import"./index-0yB0lKw6.js";const Fe=({teamId:F,fetchTeamsAndParticipants:V})=>{const[r,q]=t.useState(""),[f,j]=t.useState(""),[g,v]=t.useState(""),[ne,M]=t.useState([]),[p,y]=t.useState([]),[m,T]=t.useState(null),[n,c]=t.useState({fileUploadError:"",columnError:"",minRowError:"",maxRowError:"",validateEmailsError:"",storeEmailsError:""}),[b,_]=t.useState([]),[x,D]=t.useState(""),[N,A]=t.useState([]),[B,h]=t.useState(!1),{toast:k}=ie(),I=a=>{const s=a.target.files[0],d=new FileReader;d.onload=l=>{T(new Uint8Array(l.target.result));const i=S(new Uint8Array(l.target.result),{type:"array"});_(i.SheetNames),i.SheetNames.length===1&&D(i.SheetNames[0])},d.readAsArrayBuffer(s)};t.useEffect(()=>{if(m&&r){const s=S(m,{type:"array"}).Sheets[x],i=R.sheet_to_json(s,{header:1,raw:!1}).map(o=>o[r.charCodeAt(0)-65]).filter(o=>o!==void 0);j("1"),v(i.length.toString())}},[m,r]),t.useEffect(()=>{if(m&&r&&f&&g&&x){const s=S(m,{type:"array"}).Sheets[x],d=R.sheet_to_json(s,{header:"A",raw:!1}),l={};d.forEach((o,C)=>{C+1<Number(f)||C+1>Number(g)||Object.keys(o).forEach(u=>{l[u]||(l[u]=[]),o[u]!==""&&l[u].push(o[u])})}),M(l);const i=l[r]||[];y(i),c(o=>({...o,columnError:""})),console.log(i),console.log(p)}if(r===""){c({fileUploadError:"",columnError:"",minRowError:"",maxRowError:"",validateEmailsError:""});return}!m&&r!==""&&c(a=>({...a,fileUploadError:"Please upload a file before entering a column."}))},[r,m,f,g,x]);const O=a=>{const s=[...p];s.splice(a,1),y(s),a===0?j(s.length>0?"1":""):a===p.length-1&&v(s.length>0?s.length.toString():"")},$=async()=>{try{const a=await w.post("/api/v1/validate-emails",{emails:p.map(s=>({email:s})),removeDuplicates:!1});console.log(a.data),c(s=>({...s,validateEmailsError:""})),A(a.data.emails),a.data.message.includes("Duplicate")&&h(!0)}catch(a){console.error(a.response.data),a.response.data.message&&(c(s=>({...s,validateEmailsError:a.response.data.message})),a.response.data.message.includes("Duplicate")&&h(!0))}},G=async()=>{h(!1);try{const a=await w.post("/api/v1/validate-emails",{emails:p.map(s=>({email:s})),removeDuplicates:!0});console.log(a.data),c(s=>({...s,validateEmailsError:""})),A(a.data.emails)}catch(a){console.error(a.response.data),a.response.data.message&&c(s=>({...s,validateEmailsError:a.response.data.message}))}},H=async()=>{try{const a=await w.post("/api/v1/store-unique-emails",{emails:N,teamId:F});console.log(a.data),c(o=>({...o,storeEmailsError:""}));const{newEmails:s,existingEmails:d}=a.data,l=s.join(", "),i=d.join(", ");k({variant:"success",title:"Success!",description:`New emails added: ${l}${d.length>0?`. Already existing emails: ${i}`:""}`}),V()}catch(a){console.error(a),c(s=>({...s,storeEmailsError:a.response.data.message})),k({variant:"destructive",title:"Error!",description:a.response.data.message})}};return e.jsx("div",{className:"py-12",children:e.jsx("div",{className:"mx-auto max-w-7xl sm:px-6 lg:px-8",children:e.jsx("div",{className:"overflow-hidden bg-white sm:rounded-lg",children:e.jsxs("div",{className:"p-6 text-gray-900",children:[e.jsx(E,{type:"file",onChange:I}),b.length>1&&e.jsxs(W,{onValueChange:a=>D(a),children:[e.jsx(P,{className:"w-[180px] mt-1",children:e.jsx(X,{placeholder:"Select a Sheet",defaultValue:x})}),e.jsx(Y,{children:e.jsxs(z,{label:"Sheet Names",children:[e.jsx(J,{children:"Sheets"}),b.map((a,s)=>e.jsx(K,{value:a,children:a},s))]})})]}),e.jsx(E,{type:"text",className:"my-1",placeholder:"Enter column letter",value:r,onChange:a=>q(a.target.value.toUpperCase())}),r!==""&&e.jsxs("div",{className:"flex gap-1",children:[e.jsx(E,{type:"number",min:"1",placeholder:"Enter min row number",value:f,onChange:a=>j(a.target.value)}),e.jsx(E,{type:"number",min:"1",placeholder:"Enter max row number",value:g,onChange:a=>v(a.target.value)})]}),n.fileUploadError&&e.jsx("p",{className:"text-red-500 text-xs italic",children:n.fileUploadError}),n.columnError&&e.jsx("p",{className:"text-red-500 text-xs italic",children:n.columnError}),n.minRowError&&e.jsx("p",{className:"text-red-500 text-xs italic",children:n.minRowError}),n.maxRowError&&e.jsx("p",{className:"text-red-500 text-xs italic",children:n.maxRowError}),r!==""&&(p.length>0?e.jsxs("div",{className:"mt-4 flex flex-col",children:[e.jsx("p",{className:"mb-2 text-lg",children:"Extracted:"}),e.jsx("div",{className:"flex flex-row flex-wrap",children:p.map((a,s)=>e.jsx("div",{className:"m-1",children:e.jsxs("p",{className:"w-fit rounded-full bg-blue-300 px-4 py-2 text-black",children:[a,e.jsx("span",{className:"ml-2 cursor-pointer",onClick:()=>O(s),children:e.jsx(Z,{icon:Q})})]})},s))})]}):!n.columnError&&e.jsx("div",{className:"mt-4 flex flex-col",children:e.jsx("p",{className:"text-lg text-gray-800",children:"No data found"})})),e.jsx("div",{className:"mt-4 flex justify-end",children:e.jsx("div",{className:"flex-col",children:e.jsx(U,{onClick:$,disabled:!r||!m||!x,children:"Validate Emails"})})}),N.length>0&&e.jsxs("div",{className:"mt-4 flex flex-col",children:[e.jsx("p",{className:"mb-2 text-lg",children:"Unique Emails Extracted:"}),e.jsx("div",{className:"flex flex-row flex-wrap",children:N.map((a,s)=>e.jsx("div",{className:"m-1",children:e.jsx("p",{className:"w-fit rounded-full bg-green-300 px-4 py-2 text-black",children:a.email})},s))}),e.jsx("div",{className:"mt-4 flex justify-end",children:e.jsx("div",{className:"flex-col",children:e.jsx(U,{variant:"secondary",onClick:H,children:"Add Emails to Team"})})})]}),e.jsx(L,{open:B,onOpenChange:h,children:e.jsxs(ee,{children:[e.jsxs(ae,{children:[e.jsx(se,{children:"Delete Duplicate Emails "}),e.jsxs(te,{children:[e.jsx("p",{className:"mb-2",children:"We have detected duplicate emails in your list. Would you like us to remove them for you?"}),e.jsx("p",{children:"Having duplicate emails can result in sending invites and notifications multiple times to the same email address, corresponding to the number of times it appears in the list."})]})]}),e.jsxs(re,{children:[e.jsx(le,{variant:"outline",onClick:()=>h(!1),children:"No"}),e.jsx(oe,{variant:"",onClick:G,children:"Yes"})]})]})})]})})})})};export{Fe as default};
